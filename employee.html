<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ù…Ù‡Ø§Ù…ÙŠ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <style>
    body {
      font-family: 'Cairo', sans-serif;
      margin: 0;
      background: linear-gradient(135deg,#4facfe,#00f2fe);
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      padding: 40px 20px;
    }
    .container {
      width: 100%;
      max-width: 800px;
      background: rgba(255,255,255,0.15);
      backdrop-filter: blur(12px);
      border-radius: 16px;
      padding: 20px;
      color: #fff;
      box-shadow: 0 8px 30px rgba(0,0,0,0.2);
    }
    h2 {
      text-align: center;
      margin-bottom: 20px;
    }
    .task-card {
      background: rgba(255,255,255,0.2);
      padding: 15px;
      border-radius: 12px;
      margin-bottom: 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: transform 0.2s ease;
    }
    .task-card:hover { transform: scale(1.02); }
    .task-info { flex: 1; }
    .task-actions button {
      margin: 0 5px;
      padding: 6px 12px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: bold;
    }
    .done { background: #4caf50; color: #fff; }
    .delay { background: #ff9800; color: #fff; }
    .progress {
      margin: 20px 0;
      height: 12px;
      border-radius: 8px;
      background: rgba(255,255,255,0.2);
      overflow: hidden;
    }
    .progress-bar {
      height: 100%;
      width: 0%;
      background: #4caf50;
      transition: width 0.4s ease;
    }
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(0,0,0,0.8);
      color: #fff;
      padding: 10px 20px;
      border-radius: 8px;
      opacity: 0;
      transform: translateY(-20px);
      transition: opacity 0.4s, transform 0.4s;
    }
    .notification.show {
      opacity: 1;
      transform: translateY(0);
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>ğŸ“Œ Ù…Ù‡Ø§Ù…ÙŠ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</h2>
    <div class="progress"><div id="progressBar" class="progress-bar"></div></div>
    <div id="tasks"></div>
  </div>

  <div id="notification" class="notification"></div>

  <script>
    // Ø¥Ø¹Ø¯Ø§Ø¯ Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyA7KirsWgafKXPsQfFl3v6ssMaAb_zjTps",
      authDomain: "tasks-bce7f.firebaseapp.com",
      databaseURL: "https://tasks-bce7f-default-rtdb.firebaseio.com",
      projectId: "tasks-bce7f",
      storageBucket: "tasks-bce7f.firebasestorage.app",
      messagingSenderId: "493499367071",
      appId: "1:493499367071:web:c667a4666f1e84d8b32caa",
      measurementId: "G-HR305C8QHR"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…Ø¹Ø±Ù Ø§Ù„Ù…ÙˆØ¸Ù Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø·
    const urlParams = new URLSearchParams(window.location.search);
    const empId = urlParams.get("emp");

    const tasksDiv = document.getElementById("tasks");
    const progressBar = document.getElementById("progressBar");

    function showNotification(msg){
      const n = document.getElementById("notification");
      n.innerText = msg;
      n.classList.add("show");
      setTimeout(()=> n.classList.remove("show"),2000);
    }

    function loadTasks(){
      db.ref("tasks/"+empId).on("value", snap=>{
        const data = snap.val();
        tasksDiv.innerHTML="";
        let total=0, done=0;

        for(let id in data){
          total++;
          const task = data[id];
          if(task.status==="done") done++;

          const card = document.createElement("div");
          card.className="task-card";
          card.innerHTML=`
            <div class="task-info">
              <strong>${task.text}</strong><br>
              <small>ğŸ“… ${task.date}</small>
              ${task.delayCount ? `<br><small>â³ ØªØ£Ø¬Ù„Øª ${task.delayCount} Ù…Ø±Ø§Øª</small>` : ""}
            </div>
            <div class="task-actions">
              <button class="done" onclick="markDone('${id}')">ØªÙ… Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²</button>
              <button class="delay" onclick="delayTask('${id}')">ØªØ£Ø¬ÙŠÙ„</button>
            </div>
          `;
          tasksDiv.appendChild(card);
        }

        // ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…
        const percent = total ? Math.round((done/total)*100) : 0;
        progressBar.style.width = percent+"%";
      });
    }

    function markDone(taskId){
      db.ref("tasks/"+empId+"/"+taskId).update({status:"done"})
        .then(()=> showNotification("âœ… ØªÙ… Ø¥Ù†Ø¬Ø§Ø² Ø§Ù„Ù…Ù‡Ù…Ø©"));
    }

    function delayTask(taskId){
      const taskRef = db.ref("tasks/"+empId+"/"+taskId);
      taskRef.once("value").then(snap=>{
        const task = snap.val();
        const nextDay = new Date();
        nextDay.setDate(nextDay.getDate()+1);
        const dateStr = nextDay.toISOString().slice(0,10);

        taskRef.update({
          date: dateStr,
          status: "pending",
          delayCount: (task.delayCount||0)+1
        }).then(()=> showNotification("â³ ØªÙ… ØªØ£Ø¬ÙŠÙ„ Ø§Ù„Ù…Ù‡Ù…Ø© Ù„Ù„ÙŠÙˆÙ… Ø§Ù„ØªØ§Ù„ÙŠ"));
      });
    }

    if(empId) loadTasks();
    else tasksDiv.innerHTML="<p>âŒ Ø±Ø§Ø¨Ø· Ø§Ù„Ù…ÙˆØ¸Ù ØºÙŠØ± ØµØ§Ù„Ø­</p>";
  </script>
</body>
</html>

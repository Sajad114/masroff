<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>مولد جدول عروض (Liquid Glass)</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
<style>
  :root{
    --glass-bg: rgba(140,200,180,0.12);
    --accent: #39c2a6; /* الافتراضي فيروزي-زيتوني */
    --accent-weak: rgba(57,194,166,0.18);
    --text: #ffffff;
    --glass-border: rgba(180,255,220,0.3);
  }

  *{box-sizing:border-box}
  body{
    margin:0;
    font-family:'Tajawal',sans-serif;
    background: linear-gradient(135deg,#112521,#0f2e2b 40%, #081613 100%);
    color:var(--text);
    min-height:100vh;
    display:flex;
    flex-direction:column;
    gap:18px;
    align-items:center;
    padding:24px;
  }

  .app {
    width:100%;
    max-width:1100px;
  }

  /* رأس الأدوات */
  .toolbar {
    display:flex;
    gap:12px;
    align-items:center;
    justify-content:space-between;
    margin-bottom:6px;
    flex-wrap:wrap;
  }

  .controls {
    display:flex;
    gap:10px;
    align-items:center;
    flex-wrap:wrap;
  }

  .card {
    background: rgba(255,255,255,0.03);
    border-radius:12px;
    padding:12px;
    border:1px solid rgba(255,255,255,0.04);
    box-shadow:0 6px 30px rgba(0,0,0,0.5);
  }

  .color-picker {
    display:flex;
    gap:8px;
    align-items:center;
  }

  label.small { font-size:13px; color:rgba(255,255,255,0.8); margin-inline-end:6px; }

  input[type="color"] { width:44px; height:34px; border-radius:8px; border:none; padding:0; cursor:pointer; }

  button.btn{
    background:linear-gradient(180deg,var(--accent), color-mix(in srgb, var(--accent) 60%, black 20%));
    color:#012;
    border:none;
    padding:10px 14px;
    border-radius:10px;
    font-weight:700;
    cursor:pointer;
    box-shadow:0 6px 20px rgba(0,0,0,0.4);
  }
  button.ghost {
    background:transparent;
    color:var(--text);
    border:1px solid rgba(255,255,255,0.08);
    padding:8px 12px;
    border-radius:10px;
    cursor:pointer;
  }

  /* form اضافة صف */
  .form-row {
    display:flex;
    gap:8px;
    align-items:center;
    flex-wrap:wrap;
  }
  .form-row input, .form-row select {
    padding:8px 10px;
    border-radius:8px;
    border:1px solid rgba(255,255,255,0.06);
    background: rgba(255,255,255,0.02);
    color:var(--text);
    min-width:110px;
  }
  .form-row input.small { min-width:94px; padding:7px; font-size:14px; }

  /* القالب الزجاجي (preview) */
  .preview-wrap {
    margin-top:6px;
    display:flex;
    gap:18px;
    align-items:flex-start;
    flex-wrap:wrap;
  }

  .table-container {
    width:100%;
    max-width:720px;
    background: var(--glass-bg);
    backdrop-filter: blur(20px) saturate(150%);
    -webkit-backdrop-filter: blur(20px) saturate(150%);
    border-radius:22px;
    border:1px solid var(--glass-border);
    box-shadow:0 0 60px color-mix(in srgb, var(--accent) 40%, transparent);
    overflow:hidden;
    position:relative;
    padding:10px;
  }

  /* تأثير سائل خلفي */
  .table-container::before{
    content:"";
    position:absolute;
    inset:-30% -30% -30% -30%;
    background:
      radial-gradient(circle at 20% 30%, color-mix(in srgb,var(--accent) 25%, transparent), transparent 30%),
      radial-gradient(circle at 80% 70%, color-mix(in srgb,var(--accent) 15%, transparent), transparent 40%);
    filter:blur(50px) saturate(160%);
    z-index:0;
    transform:translate3d(0,0,0);
    animation:float 10s infinite alternate ease-in-out;
    opacity:0.9;
  }
  @keyframes float{ from{transform:translateY(0)} to{transform:translateY(10px) rotate(2deg)} }

  .table-content { position:relative; z-index:2; padding:8px; }

  h2.title {
    text-align:center;
    margin:10px 0 6px 0;
    color: color-mix(in srgb, var(--accent) 80%, white 20%);
    text-shadow: 0 0 20px color-mix(in srgb, var(--accent) 50%, transparent);
    font-size:20px;
  }

  table.stylish {
    width:100%;
    border-collapse:collapse;
    text-align:center;
    font-size:16px;
  }
  table.stylish th, table.stylish td {
    padding:12px 10px;
  }
  table.stylish th {
    background: var(--accent-weak);
    color: color-mix(in srgb,var(--accent) 80%, white 20%);
    font-weight:700;
    font-size:15px;
    text-shadow:0 0 8px rgba(0,0,0,0.2);
    backdrop-filter: blur(6px);
  }
  table.stylish td {
    color:var(--text);
    border-bottom:1px solid rgba(255,255,255,0.04);
    vertical-align:middle;
  }
  table.stylish tr:nth-child(even) td{
    background: rgba(255,255,255,0.02);
  }
  .size-small {
    display:block;
    font-size:13px;
    color: rgba(220,255,235,0.8);
    margin-top:6px;
    opacity:0.9;
  }

  /* إعدادات الجانب */
  .side-panel {
    min-width:260px;
    max-width:320px;
    width:100%;
    background: linear-gradient(180deg, rgba(255,255,255,0.02), transparent);
    border-radius:12px;
    padding:12px;
    border:1px solid rgba(255,255,255,0.03);
  }

  .side-panel h3 { margin:0 0 8px 0; font-size:16px; color:rgba(255,255,255,0.9) }

  .list-rows { max-height:260px; overflow:auto; display:flex; flex-direction:column; gap:8px; margin-top:8px; }

  .row-item {
    display:flex; justify-content:space-between; align-items:center;
    gap:8px; background: rgba(0,0,0,0.12); padding:8px; border-radius:8px;
    border:1px solid rgba(255,255,255,0.03);
  }
  .row-item .meta { text-align:left; font-size:13px; color:rgba(255,255,255,0.9) }
  .row-actions { display:flex; gap:6px }

  .muted { color: rgba(255,255,255,0.6); font-size:13px }

  /* أزرار تصدير */
  .exports { display:flex; gap:8px; margin-top:12px; flex-wrap:wrap }

  /* responsive */
  @media (max-width:980px){
    .preview-wrap { flex-direction:column; align-items:center }
    .side-panel { max-width:100% }
  }
</style>
</head>
<body>
  <div class="app">

    <div class="toolbar">
      <div class="controls card">
        <div style="display:flex;gap:8px;align-items:center;">
          <label class="small">لون أساسي</label>
          <div class="color-picker">
            <input id="colorInput" type="color" value="#39c2a6" title="غير اللون">
            <select id="preset" style="padding:8px;border-radius:8px;">
              <option value="#39c2a6">فيروزي-زيتوني (افتراضي)</option>
              <option value="#00b3ff">فيروزي ساطع</option>
              <option value="#6fcf97">أخضر فاتح</option>
              <option value="#8a6b9b">بنفسجي هادئ</option>
              <option value="#ffb86b">برتقالي دافئ</option>
            </select>
          </div>
        </div>

        <div style="display:flex;gap:8px;align-items:center;">
          <label class="small">اسم العنوان</label>
          <input id="tableTitle" type="text" placeholder="عروض شاشات سامسونك" style="min-width:220px" value="عروض شاشات سامسونك">
        </div>
      </div>

      <div style="display:flex;gap:8px;align-items:center;">
        <button id="downloadXLS" class="btn">تحميل Excel</button>
        <button id="downloadPDF" class="btn">تحميل PDF</button>
        <button id="downloadPNG" class="ghost">تحميل صورة</button>
      </div>
    </div>

    <!-- form اضافة -->
    <div class="card form-row" style="justify-content:space-between">
      <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
        <input id="inpBrand" placeholder="النوع (مثال: سامسونج)" />
        <input id="inpSize" placeholder="الحجم (مثال: 43 بوصة)" />
        <input id="inpDimensions" placeholder="المقاس (مثال: 95×55 سم)" />
        <input id="inpPrice" placeholder="السعر (مثال: 150000)" class="small" />
        <button id="addRow" class="btn">أضف الصف</button>
        <button id="clearAll" class="ghost">فراغ الجدول</button>
      </div>

      <div style="display:flex;gap:8px;align-items:center;">
        <input id="search" placeholder="بحث..." style="padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);min-width:160px;">
      </div>
    </div>

    <!-- preview + side -->
    <div class="preview-wrap">
      <div class="table-container">
        <div class="table-content">
          <h2 class="title" id="previewTitle">عروض شاشات سامسونج</h2>
          <div id="previewTableArea">
            <!-- table rendered by JS -->
          </div>
        </div>
      </div>

      <div class="side-panel card">
        <h3>الصفوف الحالية</h3>
        <div class="list-rows" id="rowsList"></div>

        <div style="margin-top:12px;">
          <div class="muted">حفظ / استيراد</div>
          <div style="display:flex;gap:8px;margin-top:8px;">
            <button id="saveJSON" class="ghost">تنزيل JSON</button>
            <input id="uploadJSON" type="file" accept=".json" style="display:none">
            <button id="btnUpload" class="ghost">استيراد JSON</button>
          </div>

          <div class="exports">
            <button id="copyHTML" class="ghost">نسخ HTML</button>
            <button id="copyTable" class="ghost">نسخ جدول</button>
          </div>
        </div>
      </div>
    </div>

  </div>

  <!-- المكتبات (CDN) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>

  <script>
    /***********************
     * بيانات داخلية (Model)
     ***********************/
    let rows = [
      // مثال مبدئي
      { brand:"سامسونك", size:"43 بوصة", dims:"95×55 سم", price:150000 },
      { brand:"سامسونك", size:"50 بوصة", dims:"109×66 سم", price:235000 },
      { brand:"سامسونك", size:"55 بوصة", dims:"112×68 سم", price:245000 },
      { brand:"سامسونك", size:"60 بوصة", dims:"122×74 سم", price:299000 },
      { brand:"سامسونك", size:"70 بوصة", dims:"—", price:429000 },
      { brand:"سامسونك", size:"75 بوصة", dims:"—", price:550000 }
    ];

    /***********************
     * عناصر الواجهة
     ***********************/
    const previewTableArea = document.getElementById('previewTableArea');
    const rowsList = document.getElementById('rowsList');
    const addRowBtn = document.getElementById('addRow');
    const clearAllBtn = document.getElementById('clearAll');
    const inpBrand = document.getElementById('inpBrand');
    const inpSize = document.getElementById('inpSize');
    const inpDims = document.getElementById('inpDimensions');
    const inpPrice = document.getElementById('inpPrice');
    const searchInput = document.getElementById('search');
    const colorInput = document.getElementById('colorInput');
    const preset = document.getElementById('preset');
    const previewTitle = document.getElementById('previewTitle');
    const tableTitleInput = document.getElementById('tableTitle');

    /***********************
     * تهيئة / ريندر
     ***********************/
    function renderTable(filter=""){
      // فلترة
      const filtered = rows.filter(r=>{
        const q = filter.trim().toLowerCase();
        if(!q) return true;
        return (r.brand + " " + r.size + " " + r.dims + " " + r.price).toLowerCase().includes(q);
      });

      const table = document.createElement('table');
      table.className = 'stylish';
      table.innerHTML = `
        <thead>
          <tr>
            <th>النوع</th>
            <th>الحجم</th>
            <th>السعر</th>
          </tr>
        </thead>
        <tbody>
          ${filtered.map((r,idx)=>`
            <tr data-idx="${idx}">
              <td>${escapeHTML(r.brand)}</td>
              <td>
                ${escapeHTML(r.size)}
                <span class="size-small">${escapeHTML(r.dims)}</span>
              </td>
              <td>${numberWithCommas(r.price)}</td>
            </tr>
          `).join('')}
        </tbody>
      `;
      previewTableArea.innerHTML = '';
      previewTableArea.appendChild(table);
    }

    function renderList(){
      rowsList.innerHTML = '';
      rows.forEach((r,i)=>{
        const div = document.createElement('div');
        div.className = 'row-item';
        div.innerHTML = `
          <div class="meta">
            <div style="font-weight:700">${escapeHTML(r.brand)} — ${escapeHTML(r.size)}</div>
            <div class="muted">${escapeHTML(r.dims)} • ${numberWithCommas(r.price)}</div>
          </div>
          <div class="row-actions">
            <button class="ghost" data-act="edit" data-i="${i}">تعديل</button>
            <button class="ghost" data-act="del" data-i="${i}">حذف</button>
          </div>
        `;
        rowsList.appendChild(div);
      });
    }

    function syncPreviewTitle(){ previewTitle.textContent = tableTitleInput.value || 'عروض' }

    // أول ريندر
    renderAll();

    function renderAll(){
      syncPreviewTitle();
      renderTable(searchInput.value);
      renderList();
      applyAccentToCSS();
    }

    /***********************
     * أحداث الواجهة
     ***********************/
    addRowBtn.addEventListener('click', ()=>{
      const brand = inpBrand.value.trim() || '—';
      const size = inpSize.value.trim() || '—';
      const dims = inpDims.value.trim() || '—';
      const price = parseInt(String(inpPrice.value).replace(/[^0-9]/g,'')) || 0;
      rows.push({brand,size,dims,price});
      // تفريغ الحقول
      inpBrand.value=''; inpSize.value=''; inpDims.value=''; inpPrice.value='';
      renderAll();
    });

    clearAllBtn.addEventListener('click', ()=>{
      if(!confirm('متأكد تريد تفريغ كل الصفوف؟')) return;
      rows = []; renderAll();
    });

    rowsList.addEventListener('click', (e)=>{
      const btn = e.target.closest('button');
      if(!btn) return;
      const i = parseInt(btn.dataset.i);
      const act = btn.dataset.act;
      if(act === 'del'){
        rows.splice(i,1); renderAll();
      } else if(act === 'edit'){
        // فتح مربع تعديل بسيط باستخدام prompt (سهل وسريع)
        const r = rows[i];
        const brand = prompt('النوع:', r.brand); if(brand===null) return;
        const size = prompt('الحجم:', r.size); if(size===null) return;
        const dims = prompt('المقاس:', r.dims); if(dims===null) return;
        const price = prompt('السعر:', r.price); if(price===null) return;
        rows[i] = { brand: brand.trim()||'—', size:size.trim()||'—', dims:dims.trim()||'—', price: parseInt(String(price).replace(/[^0-9]/g,''))||0 };
        renderAll();
      }
    });

    searchInput.addEventListener('input', ()=> renderTable(searchInput.value));
    tableTitleInput.addEventListener('input', syncPreviewTitle);

    // تغيير اللون
    colorInput.addEventListener('input', (e)=>{
      const c = e.target.value;
      setAccent(c);
    });
    preset.addEventListener('change', ()=> {
      const c = preset.value;
      colorInput.value = c;
      setAccent(c);
    });

    function setAccent(hex){
      document.documentElement.style.setProperty('--accent', hex);
      // توليد بقية الvars بناء على hex
      document.documentElement.style.setProperty('--accent-weak', hexToRgba(hex,0.16));
      document.documentElement.style.setProperty('--glass-border', hexToRgba(hex,0.25));
      applyAccentToCSS();
    }

    function applyAccentToCSS(){
      // تغيير تأثير الزل في الظلال عبر ضبط box-shadow إذا احتجنا
      // (هنا فقط نترك المتغيرات، الـ CSS يستخدمها)
    }

    /***********************
     * تصدير Excel (SheetJS)
     ***********************/
    document.getElementById('downloadXLS').addEventListener('click', ()=>{
      // تحويل إلى مصفوفة
      const aoa = [
        ['النوع','الحجم','المقاس','السعر']
      ];
      rows.forEach(r=> aoa.push([r.brand, r.size, r.dims, r.price]));
      const ws = XLSX.utils.aoa_to_sheet(aoa);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, 'Sheet1');
      const wbout = XLSX.write(wb, {bookType:'xlsx', type:'array'});
      const blob = new Blob([wbout], {type:'application/octet-stream'});
      const url = URL.createObjectURL(blob);
      downloadURL(url, 'offers.xlsx');
      setTimeout(()=>URL.revokeObjectURL(url), 1000);
    });

    /***********************
     * تصدير PDF (html2pdf)
     ***********************/
    document.getElementById('downloadPDF').addEventListener('click', ()=>{
      const element = document.querySelector('.table-container');
      const opt = {
        margin:0.4,
        filename: (tableTitleInput.value||'offers') + '.pdf',
        image:{type:'jpeg', quality:0.98},
        html2canvas:{scale:2, useCORS:true},
        jsPDF:{unit:'in', format:'a4', orientation:'portrait'}
      };
      html2pdf().set(opt).from(element).save();
    });

    /***********************
     * تحميل كصورة PNG
     ***********************/
    document.getElementById('downloadPNG').addEventListener('click', async ()=>{
      // نستخدم html2pdf مع خيار image لالتقاط
      const element = document.querySelector('.table-container');
      const opt = { margin:0, filename:'table.png', image:{type:'png', quality:1}, html2canvas:{scale:2, useCORS:true} };
      html2pdf().set(opt).from(element).toPdf().get('pdf').then(()=> {
        // لاستخدام كصورة مباشرة نستخدم html2canvas لو أردت، لكن html2pdf يولد PDF.
        alert('انتهى التصدير (تحويل لـ PDF). لو تريد PNG دقيق أقولك أضيف html2canvas مباشرة.');
      });
    });

    /***********************
     * نسخ HTML / نسخة الجدول
     ***********************/
    document.getElementById('copyHTML').addEventListener('click', ()=>{
      const html = document.querySelector('.table-container').outerHTML;
      navigator.clipboard.writeText(html).then(()=> alert('تم نسخ HTML'));
    });
    document.getElementById('copyTable').addEventListener('click', ()=>{
      // نسخ نصي للجدول
      let txt = '';
      rows.forEach(r=> txt += `${r.brand}\t${r.size}\t${r.dims}\t${r.price}\n`);
      navigator.clipboard.writeText(txt).then(()=> alert('تم نسخ الجدول كنص'));
    });

    /***********************
     * حفظ / استيراد JSON
     ***********************/
    document.getElementById('saveJSON').addEventListener('click', ()=>{
      const data = { title: tableTitleInput.value, rows };
      const blob = new Blob([JSON.stringify(data, null, 2)], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      downloadURL(url, 'offers.json');
      setTimeout(()=>URL.revokeObjectURL(url), 1000);
    });

    document.getElementById('btnUpload').addEventListener('click', ()=> document.getElementById('uploadJSON').click());
    document.getElementById('uploadJSON').addEventListener('change', (e)=>{
      const f = e.target.files[0];
      if(!f) return;
      const reader = new FileReader();
      reader.onload = ()=> {
        try{
          const data = JSON.parse(reader.result);
          if(Array.isArray(data.rows)) { rows = data.rows; tableTitleInput.value = data.title || tableTitleInput.value; renderAll(); }
          else alert('ملف JSON غير صحيح');
        }catch(err){ alert('خطأ بقراءة الملف'); }
      };
      reader.readAsText(f);
    });

    /***********************
     * مساعدة ودوال صغيرة
     ***********************/
    function numberWithCommas(x){ return String(x).replace(/\B(?=(\d{3})+(?!\d))/g, ","); }
    function escapeHTML(s){ return String(s).replace(/[&<>"']/g, (m)=> ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[m]); }
    function downloadURL(url, filename){
      const a = document.createElement('a'); a.href = url; a.download = filename; document.body.appendChild(a); a.click(); a.remove();
    }
    function hexToRgba(hex, alpha=1){
      hex = hex.replace('#','');
      if(hex.length===3) hex = hex.split('').map(s=>s+s).join('');
      const r = parseInt(hex.substring(0,2),16);
      const g = parseInt(hex.substring(2,4),16);
      const b = parseInt(hex.substring(4,6),16);
      return `rgba(${r},${g},${b},${alpha})`;
    }

    // render مبدئي
    function renderInitial(){
      renderAll();
      // وضع اللون الافتراضي
      setAccent(colorInput.value);
    }
    renderInitial();

    /***********************
     * أحداث إضافية: نسخ/تحرير عبر النقر على صف المعاينة
     ***********************/
    previewTableArea.addEventListener('click', (e)=>{
      const tr = e.target.closest('tr');
      if(!tr) return;
      const idx = parseInt(tr.dataset.idx);
      if(Number.isNaN(idx)) return;
      if(!confirm('تعديل هذا الصف؟')) return;
      const r = rows[idx];
      const brand = prompt('النوع:', r.brand); if(brand===null) return;
      const size = prompt('الحجم:', r.size); if(size===null) return;
      const dims = prompt('المقاس:', r.dims); if(dims===null) return;
      const price = prompt('السعر:', r.price); if(price===null) return;
      rows[idx] = { brand:brand||'—', size:size||'—', dims:dims||'—', price: parseInt(String(price).replace(/[^0-9]/g,''))||0 };
      renderAll();
    });

    // تحسين: تحديث العرض عند تعديل بيانات خارجية
    window.addEventListener('focus', renderAll);
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù…ÙˆÙ„Ø¯ Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ù…Ø®ØµØµ</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<style>
/* ØªØ¹Ø±ÙŠÙ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ù„Ù„Ø£Ù„ÙˆØ§Ù† */
:root {
    --bg-main: #0f172a;
    --card-bg: #1e293b;
    
    /* Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ®ØµÙŠØµ */
    --th-bg: #0f172a;           /* Ø®Ù„ÙÙŠØ© Ø±Ø£Ø³ Ø§Ù„Ø¬Ø¯ÙˆÙ„ */
    --th-text: #38bdf8;         /* Ù„ÙˆÙ† Ù†Øµ Ø±Ø£Ø³ Ø§Ù„Ø¬Ø¯ÙˆÙ„ */
    --col-brand: #e2e8f0;       /* Ù„ÙˆÙ† Ø§Ù„Ù…Ø§Ø±ÙƒØ© */
    --col-size: #f59e0b;        /* Ù„ÙˆÙ† Ø§Ù„Ø­Ø¬Ù… */
    --col-price: #22c55e;       /* Ù„ÙˆÙ† Ø§Ù„Ø³Ø¹Ø± */
    --border-color: rgba(255,255,255,0.08);
}

* { box-sizing: border-box; font-family: 'Segoe UI', Tahoma, sans-serif; }

body {
    background: var(--bg-main);
    color: #fff;
    margin: 0;
    padding: 20px;
    display: flex;
    justify-content: center;
}

.main-wrapper {
    width: 100%;
    max-width: 950px;
    display: flex;
    flex-direction: column;
    gap: 20px;
}

/* === Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… (Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª + Ø§Ù„Ø£Ù„ÙˆØ§Ù†) === */
.control-panel {
    background: var(--card-bg);
    padding: 20px;
    border-radius: 16px;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
    border: 1px solid rgba(255,255,255,0.1);
}

.panel-title { font-size: 18px; margin-bottom: 15px; color: #94a3b8; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px; }

.editor-grid {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 20px;
}

@media (max-width: 768px) { .editor-grid { grid-template-columns: 1fr; } }

textarea {
    width: 100%;
    height: 150px;
    background: #020617;
    border: 1px solid #334155;
    color: white;
    padding: 12px;
    border-radius: 8px;
    resize: none;
    font-size: 14px;
}

/* Ø£Ø¯ÙˆØ§Øª ØªØ®ØµÙŠØµ Ø§Ù„Ø£Ù„ÙˆØ§Ù† */
.color-settings {
    background: #0f172a;
    padding: 15px;
    border-radius: 8px;
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.color-option {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: rgba(255,255,255,0.03);
    padding: 8px;
    border-radius: 6px;
}

.color-option label { font-size: 13px; color: #cbd5e1; }

input[type="color"] {
    -webkit-appearance: none;
    border: none;
    width: 35px;
    height: 35px;
    border-radius: 50%;
    cursor: pointer;
    background: none;
}
input[type="color"]::-webkit-color-swatch-wrapper { padding: 0; }
input[type="color"]::-webkit-color-swatch { border: 2px solid #fff; border-radius: 50%; }

.actions {
    margin-top: 15px;
    display: flex;
    gap: 10px;
}

button {
    flex: 1;
    padding: 12px;
    border-radius: 8px;
    border: none;
    font-weight: bold;
    cursor: pointer;
    transition: 0.2s;
}

.btn-run { background: #3b82f6; color: white; }
.btn-save { background: #10b981; color: white; }
button:hover { opacity: 0.9; transform: scale(1.02); }

/* === Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¹Ø±Ø¶ (Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ) === */
.preview-container {
    background: var(--card-bg); /* Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„ØªÙŠ Ø³ØªØ¸Ù‡Ø± ÙÙŠ Ø§Ù„ØµÙˆØ±Ø© */
    border-radius: 16px;
    overflow: hidden;
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.5);
    position: relative;
}

.header-brand {
    background: linear-gradient(to right, #059669, #10b981);
    padding: 25px;
    text-align: center;
}
.header-brand h1 { margin: 0; font-size: 24px; }
.header-brand p { margin: 5px 0 0; opacity: 0.9; font-size: 14px; }

.table-wrap { padding: 20px; }

table { width: 100%; border-collapse: collapse; }

/* Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ù‡Ù†Ø§ Ù„ØªÙ„ÙˆÙŠÙ† Ø§Ù„Ø¬Ø¯ÙˆÙ„ */
thead th {
    background-color: var(--th-bg);
    color: var(--th-text);
    padding: 15px;
    font-size: 14px;
    border-bottom: 2px solid var(--th-text);
}

tbody tr { border-bottom: 1px solid var(--border-color); }
tbody tr:last-child { border-bottom: none; }

td { padding: 14px; text-align: center; font-size: 15px; }

/* ØªØ®ØµÙŠØµ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø­Ø³Ø¨ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª */
.col-brand { color: var(--col-brand); font-weight: 500; }
.col-size { color: var(--col-size); font-weight: bold; background: rgba(255,255,255,0.02); border-radius: 6px; padding: 4px 12px; display:inline-block; }
.col-price { color: var(--col-price); font-weight: 900; font-size: 17px; }

.footer {
    text-align: center;
    padding: 15px;
    font-size: 12px;
    color: #64748b;
    border-top: 1px solid rgba(255,255,255,0.05);
}

/* Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ø§Ø¦ÙŠØ© Ù„Ù„Ø´Ø±ÙƒØ© */
.watermark {
    position: absolute;
    bottom: 100px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 80px;
    opacity: 0.03;
    pointer-events: none;
    font-weight: bold;
    white-space: nowrap;
}
</style>
</head>
<body>

<div class="main-wrapper">

    <div class="control-panel">
        <div class="panel-title">âš™ï¸ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… ÙˆØ§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</div>
        
        <div class="editor-grid">
            <div>
                <textarea id="rawInput" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù‡Ù†Ø§.. Ù…Ø«Ø§Ù„:
Ø­Ø¬Ù… 43 Ø³Ø§Ù…Ø³ÙˆÙ†Ø¬ Ø§Ù„Ø³Ø¹Ø± 250 Ø§Ù„Ù
Ø­Ø¬Ù… 50 Ø§Ù„ Ø¬ÙŠ Ø§Ù„Ø³Ø¹Ø± 400
Ø³ÙˆÙ†ÙŠ Ø­Ø¬Ù… 65 Ø³Ø¹Ø± 600 Ø§Ù„Ù"></textarea>
                <div class="actions">
                    <button class="btn-run" onclick="generateTable()">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯ÙˆÙ„ ğŸ”„</button>
                    <button class="btn-save" onclick="downloadImage()">Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø© ğŸ“¸</button>
                </div>
            </div>

            <div class="color-settings">
                <div style="font-size:14px; color:#94a3b8; margin-bottom:5px;">ğŸ¨ ØªØ®ØµÙŠØµ Ø§Ù„Ø£Ù„ÙˆØ§Ù†</div>
                
                <div class="color-option">
                    <label>Ù„ÙˆÙ† Ø§Ù„Ù…Ø§Ø±ÙƒØ© (Ø§Ù„Ù†ÙˆØ¹)</label>
                    <input type="color" value="#e2e8f0" oninput="updateColor('--col-brand', this.value)">
                </div>
                
                <div class="color-option">
                    <label>Ù„ÙˆÙ† Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø­Ø¬Ù…</label>
                    <input type="color" value="#f59e0b" oninput="updateColor('--col-size', this.value)">
                </div>
                
                <div class="color-option">
                    <label>Ù„ÙˆÙ† Ø§Ù„Ø³Ø¹Ø±</label>
                    <input type="color" value="#22c55e" oninput="updateColor('--col-price', this.value)">
                </div>

                <div class="color-option">
                    <label>Ø®Ù„ÙÙŠØ© Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ†</label>
                    <input type="color" value="#0f172a" oninput="updateColor('--th-bg', this.value)">
                </div>

                <div class="color-option">
                    <label>Ù†Øµ Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ†</label>
                    <input type="color" value="#38bdf8" oninput="updateColor('--th-text', this.value)">
                </div>
            </div>
        </div>
    </div>

    <div class="preview-container" id="captureTarget">
        <div class="header-brand">
            <h1 contenteditable="true">Ø´Ø±ÙƒØ© Ø³ÙˆØ¨Ø± Ù…Ø§ÙƒØ³</h1>
            <p contenteditable="true">Ø¨ØºØ¯Ø§Ø¯ - ÙƒØ±Ø§Ø¯Ø© Ø®Ø§Ø±Ø¬ | 07711272744</p>
        </div>

        <div class="watermark">Ø³ÙˆØ¨Ø± Ù…Ø§ÙƒØ³</div>

        <div class="table-wrap">
            <table>
                <thead>
                    <tr>
                        <th>Ø§Ù„Ù…Ø§Ø±ÙƒØ© / Ø§Ù„Ø´Ø±ÙƒØ©</th>
                        <th>Ø­Ø¬Ù… Ø§Ù„Ø´Ø§Ø´Ø©</th>
                        <th>Ø§Ù„Ø³Ø¹Ø± (Ø¯ÙŠÙ†Ø§Ø±)</th>
                        <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    </tbody>
            </table>
        </div>

        <div class="footer">
            ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù‡Ø°Ù‡ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¨ØªØ§Ø±ÙŠØ® <span id="dateDisplay"></span> â€¢ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ù†Ù‡Ø§Ø¦ÙŠØ©
        </div>
    </div>

</div>

<script>
    // 1. ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ§Ø±ÙŠØ®
    document.getElementById('dateDisplay').innerText = new Date().toLocaleDateString('ar-IQ');

    // 2. Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ù„ÙˆØ§Ù† (CSS Variables)
    function updateColor(variable, value) {
        document.documentElement.style.setProperty(variable, value);
    }

    // 3. ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø£Ø±Ù‚Ø§Ù…
    function normalizeNumbers(text){
        const map = {'Ù ':'0','Ù¡':'1','Ù¢':'2','Ù£':'3','Ù¤':'4','Ù¥':'5','Ù¦':'6','Ù§':'7','Ù¨':'8','Ù©':'9'};
        return text.replace(/[Ù -Ù©]/g, d => map[d]);
    }
    
    function formatPrice(num) {
        return new Intl.NumberFormat('en-US').format(num);
    }

    // 4. ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø°ÙƒÙŠ
    function generateTable() {
        const input = document.getElementById("rawInput").value.trim();
        const body = document.getElementById("tableBody");
        body.innerHTML = "";

        if (!input) return;

        const lines = input.split("\n");

        lines.forEach(line => {
            let cleanLine = normalizeNumbers(line);
            if(cleanLine.trim() === "") return;

            // Regex Patterns
            const sizeMatch = cleanLine.match(/(\d{2,})\s*(Ø¨ÙˆØµØ©|inch)?/i) || cleanLine.match(/Ø­Ø¬Ù…\s*(\d+)/);
            const priceMatch = cleanLine.match(/(\d{2,})\s*(Ø§Ù„Ù|Ø£Ù„Ù)/) || cleanLine.match(/Ø³Ø¹Ø±\s*(\d+)/);

            if (sizeMatch && priceMatch) {
                // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù…Ø§Ø±ÙƒØ© Ø¨Ø°ÙƒØ§Ø¡ Ø¹Ù† Ø·Ø±ÙŠÙ‚ Ø­Ø°Ù Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ÙˆØ§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø­Ø¬ÙˆØ²Ø©
                let brand = cleanLine
                    .replace(sizeMatch[0], '')
                    .replace(priceMatch[0], '')
                    .replace(/Ø­Ø¬Ù…|Ø§Ù„Ø³Ø¹Ø±|Ø³Ø¹Ø±|Ø¨ÙˆØµØ©|Ø§Ù„Ù|Ø£Ù„Ù|Ø¯.Ø¹/g, '')
                    .trim();
                
                // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø±Ù…ÙˆØ²
                brand = brand.replace(/^[-â€“â€”.]/, '').trim();
                if(brand.length < 2) brand = "Ø´Ø§Ø´Ø© Ø¹Ø§Ù…Ø©";

                const tr = document.createElement("tr");
                tr.innerHTML = `
                    <td class="col-brand">${brand}</td>
                    <td><span class="col-size">${sizeMatch[1]} Ø¨ÙˆØµØ©</span></td>
                    <td class="col-price">${formatPrice(priceMatch[1])},000</td>
                    <td style="color:#94a3b8; font-size:13px">Ù…ØªÙˆÙØ± âœ…</td>
                `;
                body.appendChild(tr);
            }
        });
    }

    // 5. Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø© Ø¨Ø¯Ù‚Ø© Ø¹Ø§Ù„ÙŠØ©
    function downloadImage() {
        const element = document.getElementById("captureTarget");
        
        // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù€ border radius Ù…Ø¤Ù‚ØªØ§Ù‹ Ù„ØªØ¸Ù‡Ø± Ø§Ù„ØµÙˆØ±Ø© Ø²ÙˆØ§ÙŠØ§Ù‡Ø§ Ø­Ø§Ø¯Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
        // element.style.borderRadius = "0"; 

        html2canvas(element, {
            scale: 2, // Ø¬ÙˆØ¯Ø© Ù…Ø¶Ø§Ø¹ÙØ©
            backgroundColor: "#1e293b", // Ù†ÙØ³ Ù„ÙˆÙ† Ø®Ù„ÙÙŠØ© Ø§Ù„ÙƒØ§Ø±Ø¯
            useCORS: true
        }).then(canvas => {
            const link = document.createElement('a');
            link.download = 'Price-List.png';
            link.href = canvas.toDataURL();
            link.click();
            // element.style.borderRadius = "16px"; // Ø¥Ø±Ø¬Ø§Ø¹ Ø§Ù„Ø´ÙƒÙ„
        });
    }

    // ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¯Ø§Ù„Ø© Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ù„Ø¹Ø±Ø¶ Ù…Ø«Ø§Ù„
    window.onload = generateTable;
</script>

</body>
</html>
